<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Prism.js -->
<link
  href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
<!-- SortableJS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<div>
  <h2 class="text-2xl font-bold text-center text-indigo-600 mb-6">
    ğŸ¯ Advanced Schema Generator
  </h2>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹ -->
  <div class="mb-6">
    <label class="block text-gray-700 mb-2">Choose Schema Type:</label>
    <select
      id="schemaType"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
    >
      <option value="Article">Article</option>
      <option value="FAQPage">FAQ</option>
      <option value="HowTo">HowTo</option>
      <option value="Product">Product</option>
      <option value="VideoObject">Video</option>
      <option value="Review">Review</option>
    </select>
  </div>

  <!-- Article -->
  <form id="articleForm" class="schemaForm space-y-2">
    <input
      type="text"
      name="title"
      placeholder="Title"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="headline"
    />
    <textarea
      name="description"
      placeholder="Description"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="description"
    ></textarea>
    <input
      type="text"
      name="author"
      placeholder="Author"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="author"
    />
    <input
      type="date"
      name="datePublished"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="datePublished"
    />
    <input
      type="url"
      name="url"
      placeholder="Article URL"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="url"
    />
    <div id="articleImages"></div>
    <button
      type="button"
      onclick="addImage('articleImages')"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
    >
      â• Add Image
    </button>
    <button
      type="button"
      onclick="resetForm('articleForm')"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
    >
      â™» Reset
    </button>
  </form>

  <!-- FAQ -->
  <form id="faqForm" class="schemaForm hidden">
    <div id="faqItems"></div>
    <button
      type="button"
      onclick="addFAQ()"
      class="mt-2 bg-indigo-600 text-white px-4 py-1 rounded"
    >
      â• Add Question
    </button>
    <button
      type="button"
      onclick="resetForm('faqForm')"
      class="mt-2 bg-gray-500 text-white px-4 py-1 rounded"
    >
      â™» Reset
    </button>
  </form>

  <!-- HowTo -->
  <form id="howtoForm" class="schemaForm hidden">
    <input
      type="text"
      name="name"
      placeholder="HowTo Name"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="name"
    />
    <textarea
      name="description"
      placeholder="Description"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="description"
    ></textarea>
    <div id="howtoSteps"></div>
    <button
      type="button"
      onclick="addStep()"
      class="mt-2 bg-indigo-600 text-white px-4 py-1 rounded"
    >
      â• Add Step
    </button>
    <button
      type="button"
      onclick="resetForm('howtoForm')"
      class="mt-2 bg-gray-500 text-white px-4 py-1 rounded"
    >
      â™» Reset
    </button>
  </form>

  <!-- Product -->
  <form id="productForm" class="schemaForm hidden space-y-2">
    <input
      type="text"
      name="name"
      placeholder="Product Name"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="name"
    />
    <textarea
      name="description"
      placeholder="Description"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="description"
    ></textarea>
    <input
      type="text"
      name="brand"
      placeholder="Brand"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="brand"
    />
    <input
      type="text"
      name="sku"
      placeholder="SKU"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="sku"
    />
    <input
      type="number"
      name="price"
      placeholder="Price"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="price"
    />
    <input
      type="text"
      name="currency"
      placeholder="Currency (USD, SAR...)"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="currency"
    />
    <div id="productImages" class="flex flex-wrap gap-2"></div>
    <button
      type="button"
      onclick="addImage('productImages')"
      class="bg-indigo-600 text-white px-4 py-1 rounded"
    >
      â• Add Image
    </button>
    <button
      type="button"
      onclick="resetForm('productForm')"
      class="bg-gray-500 text-white px-4 py-1 rounded"
    >
      â™» Reset
    </button>
  </form>

  <!-- Video -->
  <form id="videoForm" class="schemaForm hidden space-y-2">
    <input
      type="text"
      name="name"
      placeholder="Video Name"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="name"
    />
    <textarea
      name="description"
      placeholder="Description"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="description"
    ></textarea>
    <input
      type="url"
      name="contentUrl"
      placeholder="Video URL"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="contentUrl"
    />
    <input
      type="url"
      name="embedUrl"
      placeholder="Embed URL"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="embedUrl"
    />
    <input
      type="date"
      name="uploadDate"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="uploadDate"
    />
    <div id="videoThumbs" class="flex flex-wrap gap-2"></div>
    <button
      type="button"
      onclick="addImage('videoThumbs')"
      class="bg-indigo-600 text-white px-4 py-1 rounded"
    >
      â• Add Thumbnail
    </button>
    <button
      type="button"
      onclick="resetForm('videoForm')"
      class="bg-gray-500 text-white px-4 py-1 rounded"
    >
      â™» Reset
    </button>
  </form>

  <!-- Review -->
  <form id="reviewForm" class="schemaForm hidden space-y-2">
    <input
      type="text"
      name="author"
      placeholder="Reviewer Name"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="author"
    />
    <textarea
      name="reviewBody"
      placeholder="Review Text"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="reviewBody"
    ></textarea>
    <input
      type="number"
      name="ratingValue"
      placeholder="Rating (1-5)"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="ratingValue"
    />
    <input
      type="number"
      name="bestRating"
      placeholder="Best Rating (usually 5)"
      class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"
      data-field="bestRating"
    />
    <button
      type="button"
      onclick="resetForm('reviewForm')"
      class="bg-gray-500 text-white px-4 py-1 rounded"
    >
      â™» Reset
    </button>
  </form>

  <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
  <div class="flex flex-wrap justify-between mt-6 gap-2">
    <button
      onclick="generateSchema()
"
      class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700"
    >
      Generate Code
    </button>
    <button
      onclick="copySchema()"
      class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700"
    >
      Copy
    </button>
    <button
      onclick="downloadSchema()"
      class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
    >
      â¬‡ Download JSON-LD
    </button>
    <button
      onclick="validateSchema()"
      class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700"
    >
      âœ… Validate
    </button>
  </div>

  <!-- Output -->
  <div class="mt-6">
    <label class="block text-gray-700 mb-1">Generated Code:</label>
    <pre
      class="rounded-lg overflow-x-auto bg-gray-900 text-green-400 p-3 text-left"
      dir="ltr"
    >
          <code id="output" class="language-markup"></code>
        </pre>
    <textarea id="hiddenOutput" hidden></textarea>
  </div>

  <!-- Preview -->
  <div class="mt-6">
    <h3 class="text-lg font-semibold mb-2">ğŸ‘€ Preview:</h3>
    <div id="preview" class="border rounded-lg p-4 bg-gray-50"></div>
  </div>
</div>

<script>
  const schemaMap = {
    Article: "articleForm",
    FAQPage: "faqForm",
    HowTo: "howtoForm",
    Product: "productForm",
    VideoObject: "videoForm",
    Review: "reviewForm",
  };

  $("#schemaType").on("change", function () {
    $(".schemaForm").addClass("hidden");
    const formId = schemaMap[this.value];
    $("#" + formId).removeClass("hidden");
    generateSchema(); // Live update
    if (this.value === "FAQPage" && $("#faqItems .faq-item").length === 0)
      addFAQ();
    if (this.value === "VideoObject" && $("#videoThumbs input").length === 0)
      addImage("videoThumbs");
  });

  // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙ†Ø©
  function addImage(containerId) {
    const container = $("#" + containerId);
    const imageWrapper = $(`
    <div class="flex flex-col items-start mb-2 border p-2 rounded relative">
      <input type="url" name="image" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" class="w-full border p-2 rounded mb-1 live-update"/>
      <img src="" class="w-24 h-16 object-cover mb-1 hidden preview-img"/>
      <button type="button" class="bg-red-600 text-white px-3 py-1 rounded absolute top-2 left-2">âŒ</button>
    </div>
  `);

    // Ø²Ø± Ø§Ù„Ø­Ø°Ù
    imageWrapper.find("button").on("click", function () {
      imageWrapper.remove();
      generateSchema();
    });

    // Live Preview
    imageWrapper.find("input").on("input", function () {
      const val = $(this).val();
      const img = $(this).siblings(".preview-img")[0];
      if (val) {
        img.src = val;
        img.classList.remove("hidden");
      } else img.classList.add("hidden");
      generateSchema();
    });

    container.append(imageWrapper);
  }

  // Live preview Ù„Ù„ØµÙˆØ±
  $(document).on("input", "input[name=image]", function () {
    const val = $(this).val();
    const img = $(this).siblings(".preview-img");
    if (val) {
      img.src = val;
      img.classList.remove("hidden");
    } else img.classList.add("hidden");
    generateSchema();
  });

  // FAQ
  function addFAQ() {
    const container = $("#faqItems");
    container.append(`
    <div class="faq-item border p-3 rounded mb-2 cursor-move">
      <input type="text" name="question" placeholder="Ø§Ù„Ø³Ø¤Ø§Ù„" class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"/>
      <textarea name="answer" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©" class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"></textarea>
      <button type="button" onclick="$(this).parent().remove(); generateSchema()" class="bg-red-600 text-white px-3 py-1 rounded">âŒ Ø­Ø°Ù</button>
    </div>
  `);
    new Sortable(container[0], { animation: 150 });
  }

  // HowTo Steps
  function addStep() {
    const container = $("#howtoSteps");
    container.append(`
    <div class="step-item border p-3 rounded mb-2 cursor-move">
      <input type="text" name="stepName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ø·ÙˆØ©" class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"/>
      <textarea name="stepText" placeholder="Ø§Ù„ÙˆØµÙ" class="w-full p-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex flex-auto mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent live-update"></textarea>
      <button type="button" onclick="$(this).parent().remove(); generateSchema()" class="bg-red-600 text-white px-3 py-1 rounded">âŒ Ø­Ø°Ù</button>
    </div>
  `);
    new Sortable(container[0], { animation: 150 });
  }

  // Reset form
  function resetForm(formId) {
    $("#" + formId)[0].reset();
    $("#" + formId + " .preview-img").remove();
    if (formId === "faqForm") $("#faqItems").empty();
    if (formId === "howtoForm") $("#howtoSteps").empty();
    if (formId === "productForm") $("#productImages").empty();
    if (formId === "videoForm") $("#videoThumbs").empty();
    generateSchema();
  }

  // ===== Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¬Ø°Ø±ÙŠ =====
  class ValidationManager {
    constructor() {
      this.errors = new Map(); // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„ÙƒÙ„ Ø­Ù‚Ù„
    }

    // Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø£ Ù„Ø­Ù‚Ù„ Ù…Ø­Ø¯Ø¯
    addError(fieldSelector, message) {
      const $field = $(fieldSelector);
      const fieldKey = this.getFieldKey($field);

      // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø®Ø·Ø£
      this.errors.set(fieldKey, {
        field: $field,
        message: message,
        selector: fieldSelector,
      });

      // Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£ ÙÙˆØ±Ø§Ù‹
      this.displayError($field, message);
    }

    // Ø¥Ø²Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ù† Ø­Ù‚Ù„ Ù…Ø­Ø¯Ø¯
    removeError(fieldSelector) {
      const $field = $(fieldSelector);
      const fieldKey = this.getFieldKey($field);

      // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
      this.errors.delete(fieldKey);

      // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶
      this.clearFieldDisplay($field);
    }

    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    clearAll() {
      this.errors.forEach((error) => {
        this.clearFieldDisplay(error.field);
      });
      this.errors.clear();
    }

    // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…Ø®Ø²Ù†Ø©
    displayAll() {
      this.errors.forEach((error) => {
        this.displayError(error.field, error.message);
      });
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡
    hasErrors() {
      return this.errors.size > 0;
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ ÙØ±ÙŠØ¯ Ù„Ù„Ø­Ù‚Ù„
    getFieldKey($field) {
      const name = $field.attr("name") || "";
      const id = $field.attr("id") || "";
      const tagName = $field.prop("tagName") || "";
      const index = $field.index();
      return `${tagName}-${name}-${id}-${index}`;
    }

    // Ø¹Ø±Ø¶ Ø®Ø·Ø£ ÙˆØ§Ø­Ø¯
    displayError($field, message) {
      const fieldKey = this.getFieldKey($field);
      const errorClass = `error-${fieldKey}`;

      // Ø¥Ø²Ø§Ù„Ø© Ø®Ø·Ø£ Ø³Ø§Ø¨Ù‚ Ù„Ù†ÙØ³ Ø§Ù„Ø­Ù‚Ù„
      $(`.${errorClass}`).remove();
      $field.removeClass("border-red-500 border-2");

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const $error = $(
        `<div class="${errorClass} field-error text-red-600 text-sm mt-1 mb-2 p-2 bg-red-50 border border-red-200 rounded">${message}</div>`
      );
      $field.after($error);
      $field.addClass("border-red-500 border-2");
    }

    // Ø¥Ø²Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø®Ø·Ø£ Ø­Ù‚Ù„ ÙˆØ§Ø­Ø¯
    clearFieldDisplay($field) {
      const fieldKey = this.getFieldKey($field);
      const errorClass = `error-${fieldKey}`;
      $(`.${errorClass}`).remove();
      $field.removeClass("border-red-500 border-2");
    }
  }

  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…
  const validator = new ValidationManager();

  // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ø³Ù†Ø© =====
  function validateTextField($field, min, max, fieldName) {
    const value = $field.val()?.trim() || "";
    const fieldSelector = validator.getFieldKey($field);

    if (value.length === 0) {
      validator.addError($field, `${fieldName} Ù…Ø·Ù„ÙˆØ¨`);
      return false;
    }

    if (value.length < min || value.length > max) {
      validator.addError(
        $field,
        `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† ${min} Ùˆ ${max} Ø­Ø±Ù`
      );
      return false;
    }

    validator.removeError($field);
    return true;
  }

  function validateNumberField($field, min, max, fieldName) {
    const value = $field.val()?.trim();

    if (!value) {
      validator.addError($field, `${fieldName} Ù…Ø·Ù„ÙˆØ¨`);
      return false;
    }

    const num = parseFloat(value);
    if (isNaN(num)) {
      validator.addError($field, `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù… ØµØ­ÙŠØ­`);
      return false;
    }

    if (num < min || num > max) {
      validator.addError(
        $field,
        `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† ${min} Ùˆ ${max}`
      );
      return false;
    }

    validator.removeError($field);
    return true;
  }

  function validateURLField($field, fieldName) {
    const value = $field.val()?.trim() || "";

    if (!value) {
      validator.addError($field, `${fieldName} Ù…Ø·Ù„ÙˆØ¨`);
      return false;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø§Ø¨Ø·
    if (!value.startsWith("http://") && !value.startsWith("https://")) {
      validator.addError(
        $field,
        `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ http:// Ø£Ùˆ https://`
      );
      return false;
    }

    try {
      new URL(value);
      validator.removeError($field);
      return true;
    } catch {
      validator.addError(
        $field,
        `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: https://example.com)`
      );
      return false;
    }
  }

  function validateDateField($field, fieldName) {
    const value = $field.val()?.trim();

    if (!value) {
      validator.addError($field, `${fieldName} Ù…Ø·Ù„ÙˆØ¨`);
      return false;
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© Ø§Ù„ØªØ§Ø±ÙŠØ® YYYY-MM-DD
    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
    if (!dateRegex.test(value)) {
      validator.addError(
        $field,
        `${fieldName} ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ØµÙŠØºØ© YYYY-MM-DD (Ù…Ø«Ø§Ù„: 2024-01-15)`
      );
      return false;
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®
    const date = new Date(value);
    if (isNaN(date.getTime())) {
      validator.addError($field, `${fieldName} ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­`);
      return false;
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠØ³ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¨Ø¹ÙŠØ¯
    const now = new Date();
    const futureLimit = new Date();
    futureLimit.setFullYear(now.getFullYear() + 10);

    if (date > futureLimit) {
      validator.addError(
        $field,
        `${fieldName} Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¨Ø¹ÙŠØ¯`
      );
      return false;
    }

    validator.removeError($field);
    return true;
  }

  function validateSelectField($field, fieldName) {
    const value = $field.val()?.trim();

    if (!value) {
      validator.addError($field, `${fieldName} Ù…Ø·Ù„ÙˆØ¨`);
      return false;
    }

    validator.removeError($field);
    return true;
  }

  // ===== ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³ÙƒÙŠÙ…Ø§ Ø§Ù„Ù…Ø­Ø³Ù† =====
  function generateSchema() {
    const type = $("#schemaType").val();
    let schema = { "@context": "https://schema.org", "@type": type };
    let previewHTML = "";

    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    validator.clearAll();

    console.log(`Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹: ${type}`);

    // ===== Article =====
    if (type === "Article") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„...");

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
      const titleValid = validateTextField(
        $("#articleForm input[name=title]"),
        5,
        110,
        "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"
      );
      const descValid = validateTextField(
        $("#articleForm textarea[name=description]"),
        20,
        300,
        "Ø§Ù„ÙˆØµÙ"
      );
      const authorValid = validateTextField(
        $("#articleForm input[name=author]"),
        3,
        50,
        "Ø§Ù„Ù…Ø¤Ù„Ù"
      );
      const dateValid = validateDateField(
        $("#articleForm input[name=datePublished]"),
        "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±"
      );
      const urlValid = validateURLField(
        $("#articleForm input[name=url]"),
        "Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø§Ù„"
      );

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
      schema.image = [];
      $("#articleImages input[name=image]").each(function () {
        const $img = $(this);
        const val = $img.val().trim();
        if (val) {
          if (validateURLField($img, "Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©")) {
            schema.image.push(val);
          }
        }
      });

      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ÙˆØªÙˆÙ‚Ù
      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ø£Ø¹Ù„Ø§Ù‡.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }

      // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³ÙƒÙŠÙ…Ø§
      schema.headline = $("#articleForm input[name=title]").val();
      schema.description = $("#articleForm textarea[name=description]").val();
      schema.author = {
        "@type": "Person",
        name: $("#articleForm input[name=author]").val(),
      };
      schema.datePublished = $("#articleForm input[name=datePublished]").val();
      schema.url = $("#articleForm input[name=url]").val();

      // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
      previewHTML = `
      <div class="border rounded-lg p-4 shadow-sm bg-white">
        <h2 class="font-bold text-xl mb-2">${schema.headline}</h2>
        <p class="text-gray-700 mb-3">${schema.description}</p>
        <div class="text-sm text-gray-500 mb-2">
          <span class="font-semibold">Ø§Ù„Ù…Ø¤Ù„Ù:</span> ${schema.author.name} | 
          <span class="font-semibold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±:</span> ${schema.datePublished}
        </div>`;

      if (schema.image.length > 0) {
        previewHTML += `<img src="${schema.image[0]}" class="w-full h-48 object-cover mt-2 rounded border" onerror="this.src='https://via.placeholder.com/400x200?text=ØµÙˆØ±Ø©+ØºÙŠØ±+Ù…ØªØ§Ø­Ø©'"/>`;
        if (schema.image.length > 1) {
          previewHTML += '<div class="flex gap-2 mt-2">';
          schema.image.slice(1, 4).forEach((imgUrl) => {
            previewHTML += `<img src="${imgUrl}" class="w-20 h-12 object-cover rounded border" onerror="this.src='https://via.placeholder.com/80x48?text=Ø®Ø·Ø£'"/>`;
          });
          if (schema.image.length > 4) {
            previewHTML += `<div class="w-20 h-12 bg-gray-200 rounded border flex items-center justify-center text-xs text-gray-600">+${
              schema.image.length - 4
            }</div>`;
          }
          previewHTML += "</div>";
        }
      }
      previewHTML += `</div>`;
    }

    // ===== FAQPage =====
    if (type === "FAQPage") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ FAQ...");

      schema.mainEntity = [];
      previewHTML = '<div class="space-y-2">';
      let hasValidQuestions = false;

      $("#faqItems .faq-item").each(function (index) {
        let $q = $(this).find("input[name=question]");
        let $a = $(this).find("textarea[name=answer]");

        const qValid = validateTextField($q, 5, 100, `Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}`);
        const aValid = validateTextField($a, 10, 500, `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${index + 1}`);

        const q = $q.val().trim();
        const a = $a.val().trim();

        if (qValid && aValid && q && a) {
          hasValidQuestions = true;
          schema.mainEntity.push({
            "@type": "Question",
            name: q,
            acceptedAnswer: { "@type": "Answer", text: a },
          });

          previewHTML += `
          <div class="border rounded-lg p-3 bg-white">
            <button onclick="this.nextElementSibling.classList.toggle('hidden')" class="w-full text-right font-semibold flex justify-between items-center hover:text-blue-600">
              <span>${q}</span> <span class="text-blue-600">â•</span>
            </button>
            <div class="hidden text-gray-700 mt-2 pt-2 border-t">${a}</div>
          </div>`;
        }
      });

      previewHTML += "</div>";

      if (!hasValidQuestions && !validator.hasErrors()) {
        validator.addError(
          $("#faqItems"),
          "ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
        );
      }

      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }
    }

    // ===== HowTo =====
    if (type === "HowTo") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ HowTo...");

      const nameValid = validateTextField(
        $("#howtoForm input[name=name]"),
        5,
        110,
        "Ø§Ø³Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©"
      );
      const descValid = validateTextField(
        $("#howtoForm textarea[name=description]"),
        20,
        300,
        "Ø§Ù„ÙˆØµÙ"
      );

      schema.name = $("#howtoForm input[name=name]").val()?.trim();
      schema.description = $("#howtoForm textarea[name=description]")
        .val()
        ?.trim();
      schema.step = [];
      let hasValidSteps = false;

      $("#howtoSteps .step-item").each(function (index) {
        const $stepName = $(this).find("input[name=stepName]");
        const $stepText = $(this).find("textarea[name=stepText]");

        const stepNameValid = validateTextField(
          $stepName,
          3,
          100,
          `Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}`
        );
        const stepTextValid = validateTextField(
          $stepText,
          5,
          300,
          `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}`
        );

        if (
          stepNameValid &&
          stepTextValid &&
          $stepName.val() &&
          $stepText.val()
        ) {
          hasValidSteps = true;
          schema.step.push({
            "@type": "HowToStep",
            name: $stepName.val(),
            itemListElement: {
              "@type": "HowToDirection",
              text: $stepText.val(),
            },
          });
        }
      });

      if (!hasValidSteps && !validator.hasErrors()) {
        validator.addError(
          $("#howtoSteps"),
          "ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© ØµØ­ÙŠØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
        );
      }

      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }

      previewHTML = `
      <div class="border rounded-lg p-4 bg-white shadow-sm">
        <h3 class="font-bold text-xl mb-2">${schema.name}</h3>
        <p class="text-gray-600 mb-4">${schema.description}</p>
        <ol class="list-decimal list-inside space-y-3">`;

      schema.step.forEach((s, index) => {
        previewHTML += `
        <li class="mb-3 p-3 bg-gray-50 rounded">
          <span class="font-semibold text-blue-600">Ø§Ù„Ø®Ø·ÙˆØ© ${index + 1}: ${
          s.name
        }</span>
          <p class="text-gray-700 mt-1">${s.itemListElement.text}</p>
        </li>`;
      });
      previewHTML += `</ol></div>`;
    }

    // ===== Product =====
    if (type === "Product") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬...");

      const nameValid = validateTextField(
        $("#productForm input[name=name]"),
        3,
        100,
        "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"
      );
      const descValid = validateTextField(
        $("#productForm textarea[name=description]"),
        10,
        300,
        "Ø§Ù„ÙˆØµÙ"
      );
      const brandValid = validateTextField(
        $("#productForm input[name=brand]"),
        2,
        50,
        "Ø§Ù„Ù…Ø§Ø±ÙƒØ©"
      );
      const skuValid = validateTextField(
        $("#productForm input[name=sku]"),
        2,
        50,
        "SKU"
      );
      const priceValid = validateNumberField(
        $("#productForm input[name=price]"),
        0,
        1000000,
        "Ø§Ù„Ø³Ø¹Ø±"
      );
      const currencyValid = validateTextField(
        $("#productForm input[name=currency]"),
        3,
        3,
        "Ø¹Ù…Ù„Ø© Ø§Ù„Ø³Ø¹Ø±"
      );

      schema.name = $("#productForm input[name=name]").val();
      schema.description = $("#productForm textarea[name=description]").val();
      schema.brand = {
        "@type": "Brand",
        name: $("#productForm input[name=brand]").val(),
      };
      schema.sku = $("#productForm input[name=sku]").val();

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
      schema.image = [];
      $("#productImages input[name=image]").each(function () {
        const $img = $(this);
        const val = $img.val().trim();
        if (val) {
          if (validateURLField($img, "Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©")) {
            schema.image.push(val);
          }
        }
      });

      schema.offers = {
        "@type": "Offer",
        price: $("#productForm input[name=price]").val(),
        priceCurrency: $("#productForm input[name=currency]").val(),
        availability: "https://schema.org/InStock",
      };

      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }

      previewHTML = `
      <div class="border rounded-lg p-4 bg-white shadow-sm">
        <h2 class="font-bold text-xl mb-2">${schema.name}</h2>
        <div class="text-2xl font-bold text-green-600 mb-2">${schema.offers.price} ${schema.offers.priceCurrency}</div>
        <p class="text-gray-700 mb-3">${schema.description}</p>
        <div class="text-sm text-gray-500 mb-3">
          <span class="font-semibold">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©:</span> ${schema.brand.name} | 
          <span class="font-semibold">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬:</span> ${schema.sku}
        </div>`;

      if (schema.image.length > 0) {
        previewHTML += `<img src="${schema.image[0]}" class="w-full h-48 object-cover mt-2 rounded border" onerror="this.src='https://via.placeholder.com/400x200?text=ØµÙˆØ±Ø©+Ø§Ù„Ù…Ù†ØªØ¬'"/>`;
        if (schema.image.length > 1) {
          previewHTML += '<div class="flex gap-2 mt-2">';
          schema.image.slice(1, 4).forEach((imgUrl) => {
            previewHTML += `<img src="${imgUrl}" class="w-20 h-12 object-cover rounded border" onerror="this.src='https://via.placeholder.com/80x48?text=Ø®Ø·Ø£'"/>`;
          });
          if (schema.image.length > 4) {
            previewHTML += `<div class="w-20 h-12 bg-gray-200 rounded border flex items-center justify-center text-xs text-gray-600">+${
              schema.image.length - 4
            }</div>`;
          }
          previewHTML += "</div>";
        }
      }
      previewHTML += `</div>`;
    }

    // ===== VideoObject =====
    if (type === "VideoObject") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ...");

      const nameValid = validateTextField(
        $("#videoForm input[name=name]"),
        3,
        100,
        "Ø§Ø³Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
      );
      const descValid = validateTextField(
        $("#videoForm textarea[name=description]"),
        10,
        300,
        "Ø§Ù„ÙˆØµÙ"
      );
      const contentUrlValid = validateURLField(
        $("#videoForm input[name=contentUrl]"),
        "Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
      );
      const embedUrlValid = validateURLField(
        $("#videoForm input[name=embedUrl]"),
        "Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¶Ù…ÙŠÙ†"
      );
      const uploadDateValid = validateDateField(
        $("#videoForm input[name=uploadDate]"),
        "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù…ÙŠÙ„"
      );

      schema.name = $("#videoForm input[name=name]").val();
      schema.description = $("#videoForm textarea[name=description]").val();
      schema.contentUrl = $("#videoForm input[name=contentUrl]").val();
      schema.embedUrl = $("#videoForm input[name=embedUrl]").val();
      schema.uploadDate = $("#videoForm input[name=uploadDate]").val();

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØµØºØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
      schema.thumbnailUrl = [];
      $("#videoThumbs input[name=image]").each(function () {
        const $img = $(this);
        const val = $img.val().trim();
        if (val) {
          if (validateURLField($img, "Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ØµØºØ±Ø©")) {
            schema.thumbnailUrl.push(val);
          }
        }
      });

      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }

      let thumb = schema.thumbnailUrl.length
        ? schema.thumbnailUrl[0]
        : "https://via.placeholder.com/400x200?text=ØµÙˆØ±Ø©+Ù…ØµØºØ±Ø©+Ù„Ù„ÙÙŠØ¯ÙŠÙˆ";

      previewHTML = `
      <div class="relative w-80 rounded-lg overflow-hidden shadow-lg bg-white">
        <div class="relative">
          <img src="${thumb}" class="w-full h-44 object-cover" onerror="this.src='https://via.placeholder.com/400x200?text=ÙÙŠØ¯ÙŠÙˆ'"/>
          <button class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white text-4xl hover:bg-opacity-70 transition-all">
            â–¶ï¸
          </button>
        </div>
        <div class="p-4">
          <h3 class="font-bold text-lg mb-2">${schema.name}</h3>
          <p class="text-sm text-gray-600 mb-2">${schema.description}</p>
          <p class="text-xs text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${schema.uploadDate}</p>
        </div>
      </div>`;
    }

    // ===== Review =====
    if (type === "Review") {
      console.log("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...");

      const authorValid = validateTextField(
        $("#reviewForm input[name=author]"),
        3,
        50,
        "Ø§Ø³Ù… Ø§Ù„ÙƒØ§ØªØ¨"
      );
      const bodyValid = validateTextField(
        $("#reviewForm textarea[name=reviewBody]"),
        5,
        300,
        "Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"
      );
      const ratingValid = validateNumberField(
        $("#reviewForm input[name=ratingValue]"),
        1,
        5,
        "Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"
      );
      const bestValid = validateNumberField(
        $("#reviewForm input[name=bestRating]"),
        1,
        5,
        "Ø£ÙØ¶Ù„ ØªÙ‚ÙŠÙŠÙ…"
      );

      if (validator.hasErrors()) {
        $("#output").html(`
        <div class="text-red-600 p-4 bg-red-50 rounded-lg border border-red-200">
          <h3 class="font-bold mb-2">âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
          <p class="text-sm">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${validator.errors.size} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</p>
        </div>
      `);
        $("#preview").html(
          '<div class="text-red-600 text-center p-4 bg-red-50 rounded">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ø³Ø¨Ø¨ ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡</div>'
        );
        return;
      }

      schema.author = {
        "@type": "Person",
        name: $("#reviewForm input[name=author]").val(),
      };
      schema.reviewBody = $("#reviewForm textarea[name=reviewBody]").val();
      schema.reviewRating = {
        "@type": "Rating",
        ratingValue: $("#reviewForm input[name=ratingValue]").val(),
        bestRating: $("#reviewForm input[name=bestRating]").val(),
      };

      const ratingValue = parseInt(
        $("#reviewForm input[name=ratingValue]").val()
      );
      const stars = "â­".repeat(ratingValue) + "â˜†".repeat(5 - ratingValue);

      previewHTML = `
      <div class="border rounded-lg p-4 bg-white shadow-sm max-w-md">
        <div class="flex items-start gap-3 mb-3">
          <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
            ${schema.author.name.charAt(0).toUpperCase()}
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-gray-800">${schema.author.name}</h4>
            <div class="flex items-center gap-2 text-sm">
              <span class="text-xl">${stars}</span>
              <span class="text-gray-600">${schema.reviewRating.ratingValue}/${
        schema.reviewRating.bestRating
      }</span>
            </div>
          </div>
        </div>
        <blockquote class="text-gray-700 italic border-l-4 border-blue-400 pl-3">
          "${schema.reviewBody}"
        </blockquote>
      </div>`;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¹Ø±Ø¶ JSON-LD Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    if (!validator.hasErrors()) {
      const jsonLDScript = `<script type="application/ld+json">\n${JSON.stringify(
        schema,
        null,
        2
      )}\n<\/script>`;

      $("#output").html(`
      <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
        <span class="text-green-600 font-semibold">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙƒÙŠÙ…Ø§ Ø¨Ù†Ø¬Ø§Ø­!</span>
      </div>
      <pre><code class="language-javascript">${Prism.highlight(
        jsonLDScript,
        Prism.languages.javascript,
        "javascript"
      )}</code></pre>
    `);

      $("#hiddenOutput").val(jsonLDScript);
      $("#preview").html(previewHTML);

      console.log(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³ÙƒÙŠÙ…Ø§ Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù†ÙˆØ¹: ${type}`);
    }
  }

  // ===== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ© =====

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
  function addRealTimeValidation() {
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
    $(document).on("input blur", "input, textarea, select", function () {
      const $field = $(this);
      const name = $field.attr("name");

      // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø­Ù‚Ù„
      if (name === "title" || name === "name") {
        if (
          $field.closest("#articleForm").length ||
          $field.closest("#howtoForm").length ||
          $field.closest("#productForm").length ||
          $field.closest("#videoForm").length
        ) {
          validateTextField(
            $field,
            3,
            110,
            $field.prev("label").text() || "Ø§Ù„Ø­Ù‚Ù„"
          );
        }
      } else if (name === "description") {
        validateTextField($field, 10, 300, "Ø§Ù„ÙˆØµÙ");
      } else if (name === "author") {
        validateTextField($field, 3, 50, "Ø§Ù„Ù…Ø¤Ù„Ù");
      } else if (name === "brand") {
        validateTextField($field, 2, 50, "Ø§Ù„Ù…Ø§Ø±ÙƒØ©");
      } else if (name === "sku") {
        validateTextField($field, 2, 50, "SKU");
      } else if (name === "currency") {
        validateTextField($field, 3, 3, "Ø¹Ù…Ù„Ø© Ø§Ù„Ø³Ø¹Ø±");
      } else if (
        name === "price" ||
        name === "ratingValue" ||
        name === "bestRating"
      ) {
        const min = name === "price" ? 0 : 1;
        const max = name === "price" ? 1000000 : 5;
        validateNumberField(
          $field,
          min,
          max,
          $field.prev("label").text() || "Ø§Ù„Ø­Ù‚Ù„"
        );
      } else if (
        name === "url" ||
        name === "contentUrl" ||
        name === "embedUrl" ||
        name === "image"
      ) {
        validateURLField($field, $field.prev("label").text() || "Ø§Ù„Ø±Ø§Ø¨Ø·");
      } else if (name === "datePublished" || name === "uploadDate") {
        validateDateField($field, $field.prev("label").text() || "Ø§Ù„ØªØ§Ø±ÙŠØ®");
      } else if (name === "question") {
        validateTextField($field, 5, 100, "Ø§Ù„Ø³Ø¤Ø§Ù„");
      } else if (name === "answer") {
        validateTextField($field, 10, 500, "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©");
      } else if (name === "stepName") {
        validateTextField($field, 3, 100, "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø·ÙˆØ©");
      } else if (name === "stepText") {
        validateTextField($field, 5, 300, "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ©");
      } else if (name === "reviewBody") {
        validateTextField($field, 5, 300, "Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…");
      }
    });
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
  function addHelpMessages() {
    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ØªØ­Øª Ø§Ù„Ø­Ù‚ÙˆÙ„
    const helpMessages = {
      'input[name="url"], input[name="contentUrl"], input[name="embedUrl"], input[name="image"]':
        "ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù€ https:// Ø£Ùˆ http://",
      'input[name="datePublished"], input[name="uploadDate"]':
        "Ø§Ø³ØªØ®Ø¯Ù… ØµÙŠØºØ© YYYY-MM-DD (Ù…Ø«Ø§Ù„: 2024-01-15)",
      'input[name="currency"]': "Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„Ø© (Ù…Ø«Ø§Ù„: USD, EUR, SAR)",
      'input[name="ratingValue"], input[name="bestRating"]': "Ø±Ù‚Ù… Ø¨ÙŠÙ† 1 Ùˆ 5",
      'input[name="price"]': "Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· (Ù…Ø«Ø§Ù„: 99.99)",
    };

    Object.keys(helpMessages).forEach((selector) => {
      $(selector).each(function () {
        const $field = $(this);
        if (!$field.next(".help-message").length) {
          $field.after(
            `<div class="help-message text-xs text-gray-500 mt-1">${helpMessages[selector]}</div>`
          );
        }
      });
    });
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„
  function showFieldStats() {
    $(document).on("input", 'input[type="text"], textarea', function () {
      const $field = $(this);
      const value = $field.val() || "";
      const maxLength = $field.attr("maxlength") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

      let $counter = $field.siblings(".char-counter");
      if ($counter.length === 0) {
        $counter = $(
          '<div class="char-counter text-xs text-gray-500 mt-1"></div>'
        );
        $field.after($counter);
      }

      $counter.text(`${value.length} Ø­Ø±Ù`);

      // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø·ÙˆÙ„
      if (value.length > maxLength * 0.9 && maxLength !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") {
        $counter
          .addClass("text-orange-500")
          .removeClass("text-gray-500 text-green-500");
      } else if (value.length > maxLength * 0.7 && maxLength !== "ØºÙŠØ± Ù…Ø­Ø¯Ø¯") {
        $counter
          .addClass("text-green-500")
          .removeClass("text-gray-500 text-orange-500");
      } else {
        $counter
          .addClass("text-gray-500")
          .removeClass("text-orange-500 text-green-500");
      }
    });
  }

  // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¨ØµÙˆØ±Ø© Ù…ØªÙ‚Ø¯Ù…Ø©
  function validateAdvancedURL(url) {
    try {
      const urlObj = new URL(url);

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
      if (!["http:", "https:"].includes(urlObj.protocol)) {
        return {
          valid: false,
          message: "ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ http Ø£Ùˆ https",
        };
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ù†Ø·Ø§Ù‚
      if (!urlObj.hostname || urlObj.hostname.length < 3) {
        return { valid: false, message: "Ø§Ø³Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­" };
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù†Ø·Ø§Ù‚
      const domainRegex =
        /^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9](?:\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])*$/;
      if (!domainRegex.test(urlObj.hostname)) {
        return { valid: false, message: "ØµÙŠØºØ© Ø§Ø³Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­Ø©" };
      }

      return { valid: true, message: "Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­" };
    } catch {
      return { valid: false, message: "Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­" };
    }
  }

  // Ø¯Ø§Ù„Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
  function enhanceForms() {
    // Ø¥Ø¶Ø§ÙØ© Ø®ØµØ§Ø¦Øµ HTML5
    $(
      'input[name="url"], input[name="contentUrl"], input[name="embedUrl"], input[name="image"]'
    ).attr("type", "url");
    $('input[name="datePublished"], input[name="uploadDate"]').attr(
      "type",
      "date"
    );
    $(
      'input[name="price"], input[name="ratingValue"], input[name="bestRating"]'
    ).attr("type", "number");

    // Ø¥Ø¶Ø§ÙØ© placeholders Ù…ÙÙŠØ¯Ø©
    $('input[name="url"]').attr("placeholder", "https://example.com/article");
    $('input[name="contentUrl"]').attr(
      "placeholder",
      "https://youtube.com/watch?v=..."
    );
    $('input[name="embedUrl"]').attr(
      "placeholder",
      "https://youtube.com/embed/..."
    );
    $('input[name="image"]').attr(
      "placeholder",
      "https://example.com/image.jpg"
    );
    $('input[name="currency"]').attr("placeholder", "USD");
    $('input[name="sku"]').attr("placeholder", "ABC-123");

    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ù„Ù„Ø­Ù‚ÙˆÙ„
    $('input[name="title"], input[name="name"]').attr("maxlength", "110");
    $('textarea[name="description"]').attr("maxlength", "300");
    $('input[name="author"]').attr("maxlength", "50");
    $('input[name="brand"]').attr("maxlength", "50");
    $('input[name="sku"]').attr("maxlength", "50");
    $('input[name="currency"]').attr("maxlength", "3");
    $('input[name="question"]').attr("maxlength", "100");
    $('textarea[name="answer"]').attr("maxlength", "500");
    $('input[name="stepName"]').attr("maxlength", "100");
    $('textarea[name="stepText"]').attr("maxlength", "300");
    $('textarea[name="reviewBody"]').attr("maxlength", "300");

    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯ÙˆØ¯ Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
    $('input[name="price"]').attr({
      min: "0",
      max: "1000000",
      step: "0.01",
    });
    $('input[name="ratingValue"], input[name="bestRating"]').attr({
      min: "1",
      max: "5",
      step: "1",
    });
  }

  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  $(document).ready(function () {
    addRealTimeValidation();
    addHelpMessages();
    showFieldStats();
    enhanceForms();

    console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ø³Ù† Ø¨Ù†Ø¬Ø§Ø­");
  });

  // ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
  window.validator = validator;
  window.validateTextField = validateTextField;
  window.validateNumberField = validateNumberField;
  window.validateURLField = validateURLField;
  window.validateDateField = validateDateField;

  // ===== live validation Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© =====
  $(document).on("input", "input, textarea", function () {
    $(this).removeClass("border-red-500");
    $(this).siblings(".field-error").remove();
    generateSchema();
  });

  // Ø§Ù„Ù†Ø³Ø®
  function copySchema() {
    const code = $("#hiddenOutput").val();

    if (!code) {
      alert("âš ï¸ Ø¨Ø±Ø¬Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø³Ø®");
      return;
    }

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API
    navigator.clipboard
      .writeText(code)
      .then(() => {
        alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
      })
      .catch((err) => {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®: " + err);
      });
  }

  // Ø§Ù„ØªØ­Ù…ÙŠÙ„
  function downloadSchema() {
    const blob = new Blob([$("#hiddenOutput").val()], {
      type: "application/ld+json",
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "schema.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚
  function validateSchema() {
    const code = $("#hiddenOutput").val().trim();
    if (!code) {
      alert("âš ï¸ Ø¨Ø±Ø¬Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù‚Ù‚");
      return;
    }
    const form = document.createElement("form");
    form.method = "POST";
    form.action = "https://search.google.com/test/rich-results";
    form.target = "_blank";
    const input = document.createElement("textarea");
    input.name = "code_snippet";
    input.value = code;
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
  }

  // Live Update Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
  $(".live-update").on("input", generateSchema);
</script>
